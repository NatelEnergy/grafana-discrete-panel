{"version":3,"sources":["../src/module.js"],"names":["config","CanvasPanelCtrl","_","moment","angular","DiscretePanelCtrl","$scope","$injector","$q","data","panelDefaults","rowHeight","padding","valueMaps","value","op","text","mappingTypes","name","rangeMaps","from","to","colorMaps","color","metricNameColor","valueTextColor","backgroundColor","lineColor","writeLastValue","writeAllValues","writeMetricNames","writeMetricNamesOnRight","metricNamesOnRightWidth","showLegend","showLegendNames","showLegendPercent","highlightOnMouseover","queryAllData","eventBeginField","eventEndField","eventNameField","defaults","panel","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","onRefresh","updateColorInfo","err","console","log","addEditorTab","editorTabIndex","refresh","context","$","wrap","css","top","right","bottom","left","rect","getBoundingClientRect","rows","length","height","width","canvas","ctx","lineWidth","textBaseline","elapsed","range","forEach","metric","centerV","fillStyle","fillRect","lastBS","point","changes","i","start","xt","w","x","ms","getColor","val","font","textAlign","fillText","strokeStyle","beginPath","moveTo","lineTo","stroke","mouse","position","down","next","ts","globalCompositeOperation","fill","xmin","Math","min","xmax","max","pos","time","body","dashboard","formatDate","duration","humanize","$tooltip","html","place_tt","pageX","pageY","info","count","detach","stats","isNumber","map","parseFloat","isNull","isNil","isString","toString","has","colorMap","palet","abs","hashCode","letters","split","floor","random","str","hash","char","charCodeAt","datasource","timeSrv","timeRange","metricsQuery","panelId","id","rangeRaw","interval","intervalMs","targets","format","renderer","maxDataPoints","resolution","scopedVars","cacheTimeout","query","pt","end","res","valToInfo","tooManyValues","v","dataList","type","datapoints","utc","startMs","valueOf","endMs","diff","legendInfo","push","target","last","norm","formatValue","_processLast","nullText","per","splice","round","index","indexOf","cm","m","render","what","randomColor","rangeMap","evt","clientX","y","clientY","hover","j","hoverPoint","showTooltip","where","up","setTime","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,Y;;AAECC,qB,iBAAAA,e;;AAEDC,O;;AACAC,Y;;AACAC,a;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2BAEDC,iB;;;AAEJ,mCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,EAA/B,EAAmC;AAAA;;AAAA,4IAC3BF,MAD2B,EACnBC,SADmB,EACRC,EADQ;;AAGjC,gBAAKC,IAAL,GAAY,IAAZ;;AAEA;AACA,cAAIC,gBAAgB;AAClBC,uBAAW,EADO;AAElBC,qBAAS,EAAE,QAAQ,CAAV,EAAa,SAAS,CAAtB,EAAyB,OAAO,CAAhC,EAAmC,UAAU,CAA7C,EAFS;AAGlBC,uBAAW,CACT,EAAEC,OAAO,MAAT,EAAiBC,IAAI,GAArB,EAA0BC,MAAM,KAAhC,EADS,CAHO;AAMlBC,0BAAc,CACZ,EAACC,MAAM,eAAP,EAAwBJ,OAAO,CAA/B,EADY,EAEZ,EAACI,MAAM,eAAP,EAAwBJ,OAAO,CAA/B,EAFY,CANI;AAUlBK,uBAAW,CACT,EAAEC,MAAM,MAAR,EAAgBC,IAAI,MAApB,EAA4BL,MAAM,KAAlC,EADS,CAVO;AAalBM,uBAAW,CACT,EAAEN,MAAM,KAAR,EAAeO,OAAO,MAAtB,EADS,CAbO;AAgBlBC,6BAAiB,SAhBC;AAiBlBC,4BAAgB,SAjBE;AAkBlBC,6BAAiB,0BAlBC;AAmBlBC,uBAAW,0BAnBO;AAoBlBC,4BAAgB,IApBE;AAqBlBC,4BAAgB,KArBE;AAsBlBC,8BAAkB,KAtBA;AAuBlBC,qCAAyB,KAvBP;AAwBlBC,qCAAyB,GAxBP;AAyBlBC,wBAAY,IAzBM;AA0BlBC,6BAAiB,IA1BC;AA2BlBC,+BAAmB,IA3BD;AA4BlBC,kCAAsB,IA5BJ;AA6BlBC,0BAAc,KA7BI;AA8BlBC,6BAAiB,OA9BC;AA+BlBC,2BAAe,KA/BG;AAgClBC,4BAAgB;AAhCE,WAApB;AAkCAtC,YAAEuC,QAAF,CAAW,MAAKC,KAAhB,EAAuBhC,aAAvB;;AAEA,gBAAKiC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKG,QAAL,CAAcD,IAAd,OAAzB;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKI,cAAL,CAAoBF,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKK,WAAL,CAAiBH,IAAjB,OAA7B;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKM,SAAL,CAAeJ,IAAf,OAA1B;;AAEA,gBAAKK,eAAL;AAhDiC;AAiDlC;;;;sCAEWC,G,EAAK;AACfC,oBAAQC,GAAR,CAAY,aAAZ,EAA2BF,GAA3B;AACD;;;2CAEgB;AACf,iBAAKG,YAAL,CAAkB,SAAlB,EAA6B,iDAA7B,EAA+E,CAA/E;AACA,iBAAKA,YAAL,CAAkB,QAAlB,EAA4B,iDAA5B,EAA8E,CAA9E;AACA,iBAAKA,YAAL,CAAkB,UAAlB,EAA8B,mDAA9B,EAAmF,CAAnF;AACA,iBAAKC,cAAL,GAAsB,CAAtB;AACA,iBAAKC,OAAL;AACD;;;qCAEU;AAAA;;AACT,gBAAI,CAAE,KAAKC,OAAX,EAAsB;AACpBL,sBAAQC,GAAR,CAAa,aAAb;AACA;AACD;;AAED,gBAAG,KAAK7C,IAAL,IAAa,IAAhB,EAAsB;AACpB4C,sBAAQC,GAAR,CAAa,UAAb;AACA;AACD;;AAEJ;;AAEGK,cAAE,KAAKC,IAAP,EAAaC,GAAb,CAAkB,aAAlB,EAAiC,KAAKnB,KAAL,CAAW9B,OAAX,CAAmBkD,GAApD;AACAH,cAAE,KAAKC,IAAP,EAAaC,GAAb,CAAkB,eAAlB,EAAmC,KAAKnB,KAAL,CAAW9B,OAAX,CAAmBmD,KAAtD;AACAJ,cAAE,KAAKC,IAAP,EAAaC,GAAb,CAAkB,gBAAlB,EAAoC,KAAKnB,KAAL,CAAW9B,OAAX,CAAmBoD,MAAvD;AACAL,cAAE,KAAKC,IAAP,EAAaC,GAAb,CAAkB,cAAlB,EAAkC,KAAKnB,KAAL,CAAW9B,OAAX,CAAmBqD,IAArD;;AAEA,gBAAIC,OAAO,KAAKN,IAAL,CAAUO,qBAAV,EAAX;;AAEA,gBAAIC,OAAO,KAAK3D,IAAL,CAAU4D,MAArB;AACA,gBAAI1D,YAAY,KAAK+B,KAAL,CAAW/B,SAA3B;;AAEA,gBAAI2D,SAAS3D,YAAYyD,IAAzB;AACA,gBAAIG,QAAQL,KAAKK,KAAL,GAAa,KAAK7B,KAAL,CAAW9B,OAAX,CAAmBqD,IAAhC,GAAuC,KAAKvB,KAAL,CAAW9B,OAAX,CAAmBmD,KAAtE;AACA,iBAAKS,MAAL,CAAYD,KAAZ,GAAoBA,KAApB;AACA,iBAAKC,MAAL,CAAYF,MAAZ,GAAqBA,MAArB;;AAEA,gBAAI,KAAK5B,KAAL,CAAWX,uBAAf,EAAwC;AACtCwC,uBAAS,KAAK7B,KAAL,CAAWV,uBAApB;AACD;;AAED,gBAAIyC,MAAM,KAAKf,OAAf;AACAe,gBAAIC,SAAJ,GAAgB,CAAhB;AACAD,gBAAIE,YAAJ,GAAmB,QAAnB;;AAEA;AACA;AACA;AACA;;AAEA,gBAAIb,MAAM,CAAV;;AAEA,gBAAIc,UAAU,KAAKC,KAAL,CAAWxD,EAAX,GAAgB,KAAKwD,KAAL,CAAWzD,IAAzC;;AAEAlB,cAAE4E,OAAF,CAAU,KAAKrE,IAAf,EAAqB,UAACsE,MAAD,EAAY;AAC/B,kBAAIC,UAAUlB,MAAOnD,YAAU,CAA/B;;AAEA;AACA8D,kBAAIQ,SAAJ,GAAgB,OAAKvC,KAAL,CAAWhB,eAA3B;AACA+C,kBAAIS,QAAJ,CAAa,CAAb,EAAgBpB,GAAhB,EAAqBS,KAArB,EAA4B5D,SAA5B;;AAEA;;;;;;;AAOA,kBAAIwE,SAAS,CAAb;AACA,kBAAIC,QAAQL,OAAOM,OAAP,CAAe,CAAf,CAAZ;AACA,mBAAI,IAAIC,IAAE,CAAV,EAAaA,IAAEP,OAAOM,OAAP,CAAehB,MAA9B,EAAsCiB,GAAtC,EAA2C;AACzCF,wBAAQL,OAAOM,OAAP,CAAeC,CAAf,CAAR;AACA,oBAAGF,MAAMG,KAAN,IAAe,OAAKV,KAAL,CAAWxD,EAA7B,EAAiC;AAC7B,sBAAImE,KAAK,CAAT;AACA,sBAAIC,IAAI,CAAR;AACA,sBAAIL,MAAMG,KAAN,GAAc,OAAKV,KAAL,CAAWzD,IAA7B,EAAmC;AAC/BoE,yBAAKJ,MAAMG,KAAN,GAAc,OAAKV,KAAL,CAAWzD,IAA9B;AACAgE,0BAAMM,CAAN,GAAWF,KAAKZ,OAAN,GAAiBL,KAA3B;AACAkB,wBAAIlB,SAAOa,MAAMO,EAAN,GAASf,OAAhB,CAAJ;AACH,mBAJD,MAIO;AACHY,yBAAK,CAAL;AACAJ,0BAAMM,CAAN,GAAU,CAAV;AACAD,wBAAIlB,SAAO,CAACa,MAAMO,EAAN,IAAU,OAAKd,KAAL,CAAWzD,IAAX,GAAgBgE,MAAMG,KAAhC,CAAD,IAAyCX,OAAhD,CAAJ;AACH;AACH,sBAAIQ,MAAMM,CAAN,GAAUD,CAAV,GAAclB,KAAlB,EAAyB;AACvBkB,wBAAIlB,QAAMa,MAAMM,CAAhB;AACD;AACDjB,sBAAIQ,SAAJ,GAAgB,OAAKW,QAAL,CAAeR,MAAMS,GAArB,CAAhB;AACApB,sBAAIS,QAAJ,CAAaE,MAAMM,CAAnB,EAAsB5B,GAAtB,EAA2B2B,CAA3B,EAA8B9E,SAA9B;;AAEA,sBAAG,OAAK+B,KAAL,CAAWb,cAAd,EAA8B;AAC5B4C,wBAAIQ,SAAJ,GAAgB,OAAKvC,KAAL,CAAWjB,cAA3B;AACAgD,wBAAIqB,IAAJ,GAAYnF,YAAU,CAAX,GAAgB,8CAA3B;AACA8D,wBAAIsB,SAAJ,GAAgB,MAAhB;;AAEAtB,wBAAIuB,QAAJ,CAAaZ,MAAMS,GAAnB,EAAwBT,MAAMM,CAAN,GAAQ,CAAhC,EAAmCV,OAAnC;AACD;AACDG,2BAASC,MAAMM,CAAf;AACD;AACF;;AAID,kBAAG5B,MAAI,CAAP,EAAU;AACRW,oBAAIwB,WAAJ,GAAkB,OAAKvD,KAAL,CAAWf,SAA7B;AACA8C,oBAAIyB,SAAJ;AACAzB,oBAAI0B,MAAJ,CAAW,CAAX,EAAcrC,GAAd;AACAW,oBAAI2B,MAAJ,CAAW7B,KAAX,EAAkBT,GAAlB;AACAW,oBAAI4B,MAAJ;AACD;;AAED5B,kBAAIQ,SAAJ,GAAgB,SAAhB;AACAR,kBAAIqB,IAAJ,GAAYnF,YAAU,CAAX,GAAgB,8CAA3B;;AAEA,kBAAG,OAAK+B,KAAL,CAAWZ,gBAAX,KAAgC,CAAC,OAAKY,KAAL,CAAWN,oBAAZ,IAAqC,OAAKM,KAAL,CAAWN,oBAAX,KAAoC,OAAKkE,KAAL,CAAWC,QAAX,IAAqB,IAArB,IAA6B,OAAKD,KAAL,CAAWC,QAAX,CAAoBb,CAApB,GAAwB,GAAzF,CAArE,CAAH,EAA6K;AAC3KjB,oBAAIQ,SAAJ,GAAgB,OAAKvC,KAAL,CAAWlB,eAA3B;AACAiD,oBAAIsB,SAAJ,GAAgB,MAAhB;AACA,oBAAIL,IAAI,EAAR;AACA,oBAAI,OAAKhD,KAAL,CAAWX,uBAAf,EAAwC;AACtC2D,sBAAInB,QAAM,EAAV;AACD;AACDE,oBAAIuB,QAAJ,CAAcjB,OAAO7D,IAArB,EAA2BwE,CAA3B,EAA8BV,OAA9B;AACD;;AAEDP,kBAAIsB,SAAJ,GAAgB,OAAhB;;AAEA,kBAAI,OAAKO,KAAL,CAAWE,IAAX,IAAmB,IAAvB,EAA8B;AAC5B,oBAAI,OAAK9D,KAAL,CAAWN,oBAAX,IAAmC,OAAKkE,KAAL,CAAWC,QAAX,IAAuB,IAA9D,EAAqE;AACnEnB,0BAAQL,OAAOM,OAAP,CAAe,CAAf,CAAR;AACA,sBAAIoB,OAAO,IAAX;AACA,uBAAI,IAAInB,IAAE,CAAV,EAAaA,IAAEP,OAAOM,OAAP,CAAehB,MAA9B,EAAsCiB,GAAtC,EAA2C;AACzC,wBAAGP,OAAOM,OAAP,CAAeC,CAAf,EAAkBC,KAAlB,GAA0B,OAAKe,KAAL,CAAWC,QAAX,CAAoBG,EAAjD,EAAqD;AACnDD,6BAAO1B,OAAOM,OAAP,CAAeC,CAAf,CAAP;AACA;AACD;AACDF,4BAAQL,OAAOM,OAAP,CAAeC,CAAf,CAAR;AACD;;AAED;AACAb,sBAAIkC,wBAAJ,GAA+B,iBAA/B;AACAlC,sBAAIQ,SAAJ,GAAgB,0BAAhB;AACAR,sBAAIyB,SAAJ;AACAzB,sBAAIS,QAAJ,CAAa,CAAb,EAAgBpB,GAAhB,EAAqBsB,MAAMM,CAA3B,EAA8B/E,SAA9B;AACA8D,sBAAImC,IAAJ;;AAEA,sBAAGH,QAAQ,IAAX,EAAiB;AACfhC,wBAAIyB,SAAJ;AACAzB,wBAAIS,QAAJ,CAAauB,KAAKf,CAAlB,EAAqB5B,GAArB,EAA0BS,KAA1B,EAAiC5D,SAAjC;AACA8D,wBAAImC,IAAJ;AACD;AACDnC,sBAAIkC,wBAAJ,GAA+B,aAA/B;;AAEA;AACAlC,sBAAIQ,SAAJ,GAAgB,SAAhB;AACAR,sBAAIqB,IAAJ,GAAYnF,YAAU,CAAX,GAAgB,8CAA3B;AACA8D,sBAAIsB,SAAJ,GAAgB,MAAhB;AACAtB,sBAAIuB,QAAJ,CAAcZ,MAAMS,GAApB,EAAyBT,MAAMM,CAAN,GAAQ,EAAjC,EAAqCV,OAArC;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACD,iBAzCD,MA0CK,IAAI,OAAKtC,KAAL,CAAWd,cAAf,EAAgC;AACnC6C,sBAAIuB,QAAJ,CAAcZ,MAAMS,GAApB,EAAyBtB,QAAM,EAA/B,EAAmCS,OAAnC;AACD;AACF;;AAEDlB,qBAAOnD,SAAP;AACD,aAzHD;;AA4HA,gBAAG,KAAK2F,KAAL,CAAWC,QAAX,IAAuB,IAAvB,IAA+B,KAAKD,KAAL,CAAWC,QAAX,CAAoBb,CAApB,GAAwBnB,KAA1D,EAAiE;AAC/D,kBAAG,KAAK+B,KAAL,CAAWE,IAAX,IAAmB,IAAtB,EAA4B;AAC1B,oBAAIK,OAAOC,KAAKC,GAAL,CAAU,KAAKT,KAAL,CAAWC,QAAX,CAAoBb,CAA9B,EAAiC,KAAKY,KAAL,CAAWE,IAAX,CAAgBd,CAAjD,CAAX;AACA,oBAAIsB,OAAOF,KAAKG,GAAL,CAAU,KAAKX,KAAL,CAAWC,QAAX,CAAoBb,CAA9B,EAAiC,KAAKY,KAAL,CAAWE,IAAX,CAAgBd,CAAjD,CAAX;;AAEA;AACAjB,oBAAIkC,wBAAJ,GAA+B,iBAA/B;AACAlC,oBAAIQ,SAAJ,GAAgB,0BAAhB;AACAR,oBAAIyB,SAAJ;AACAzB,oBAAIS,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB2B,IAAnB,EAAyBvC,MAAzB;AACAG,oBAAImC,IAAJ;;AAEAnC,oBAAIyB,SAAJ;AACAzB,oBAAIS,QAAJ,CAAa8B,IAAb,EAAmB,CAAnB,EAAsBzC,KAAtB,EAA6BD,MAA7B;AACAG,oBAAImC,IAAJ;AACAnC,oBAAIkC,wBAAJ,GAA+B,aAA/B;AACD,eAfD,MAgBK;AACHlC,oBAAIwB,WAAJ,GAAkB,MAAlB;AACAxB,oBAAIyB,SAAJ;AACAzB,oBAAI0B,MAAJ,CAAW,KAAKG,KAAL,CAAWC,QAAX,CAAoBb,CAA/B,EAAkC,CAAlC;AACAjB,oBAAI2B,MAAJ,CAAW,KAAKE,KAAL,CAAWC,QAAX,CAAoBb,CAA/B,EAAkCpB,MAAlC;AACAG,oBAAIC,SAAJ,GAAgB,CAAhB;AACAD,oBAAI4B,MAAJ;;AAEA5B,oBAAIyB,SAAJ;AACAzB,oBAAI0B,MAAJ,CAAW,KAAKG,KAAL,CAAWC,QAAX,CAAoBb,CAA/B,EAAkC,CAAlC;AACAjB,oBAAI2B,MAAJ,CAAW,KAAKE,KAAL,CAAWC,QAAX,CAAoBb,CAA/B,EAAkCpB,MAAlC;AACAG,oBAAIwB,WAAJ,GAAkB,SAAlB;AACAxB,oBAAIC,SAAJ,GAAgB,CAAhB;AACAD,oBAAI4B,MAAJ;AACD;AACF;AACF;;;sCAEWa,G,EAAK9B,K,EAAO;AACtB,gBAAIhE,OAAOgE,MAAMG,KAAjB;AACA,gBAAIlE,KAAK+D,MAAMG,KAAN,GAAcH,MAAMO,EAA7B;AACA,gBAAIwB,OAAO/B,MAAMO,EAAjB;AACA,gBAAIE,MAAMT,MAAMS,GAAhB;;AAEA,gBAAG,KAAKS,KAAL,CAAWE,IAAX,IAAmB,IAAtB,EAA4B;AAC1BpF,qBAAO0F,KAAKC,GAAL,CAAS,KAAKT,KAAL,CAAWE,IAAX,CAAgBE,EAAzB,EAA6B,KAAKJ,KAAL,CAAWC,QAAX,CAAoBG,EAAjD,CAAP;AACArF,mBAAOyF,KAAKG,GAAL,CAAS,KAAKX,KAAL,CAAWE,IAAX,CAAgBE,EAAzB,EAA6B,KAAKJ,KAAL,CAAWC,QAAX,CAAoBG,EAAjD,CAAP;AACAS,qBAAO9F,KAAKD,IAAZ;AACAyE,oBAAM,UAAN;AACD;;AAED,gBAAIuB,OAAO,qCAAoCvB,GAApC,GAA0C,QAArD;;AAEAuB,oBAAQ,UAAR;AACAA,oBAAQ,KAAKC,SAAL,CAAeC,UAAf,CAA2BnH,OAAOiB,IAAP,CAA3B,IAA4C,OAApD;AACAgG,oBAAQ,SAAR;AACAA,oBAAQ,KAAKC,SAAL,CAAeC,UAAf,CAA2BnH,OAAOkB,EAAP,CAA3B,IAA0C,YAAlD;AACA+F,oBAAQjH,OAAOoH,QAAP,CAAgBJ,IAAhB,EAAsBK,QAAtB,KAAmC,OAA3C;AACAJ,oBAAQ,WAAR;;AAEA,iBAAKK,QAAL,CAAcC,IAAd,CAAmBN,IAAnB,EAAyBO,QAAzB,CAAkCT,IAAIU,KAAJ,GAAY,EAA9C,EAAkDV,IAAIW,KAAtD;AACD;;;4CAGiBX,G,EAAKY,I,EAAM;AAC3B,gBAAIV,OAAO,qCAAoCU,KAAKjC,GAAzC,GAA8C,QAAzD;;AAEAuB,oBAAQ,UAAR;AACA,gBAAGU,KAAKC,KAAL,GAAa,CAAhB,EAAmB;AACjBX,sBAAQU,KAAKC,KAAL,GAAa,qBAArB;AACD;AACDX,oBAAQjH,OAAOoH,QAAP,CAAgBO,KAAKnC,EAArB,EAAyB6B,QAAzB,EAAR;AACA,gBAAGM,KAAKC,KAAL,GAAa,CAAhB,EAAmB;AACjBX,sBAAQ,YAAR;AACD;AACDA,oBAAQ,WAAR;;AAEA,iBAAKK,QAAL,CAAcC,IAAd,CAAmBN,IAAnB,EAAyBO,QAAzB,CAAkCT,IAAIU,KAAJ,GAAY,EAA9C,EAAkDV,IAAIW,KAAtD;AACD;;;oCAES;AACR,iBAAKJ,QAAL,CAAcO,MAAd;AACD;;;sCAEWnC,G,EAAKoC,K,EAAO;;AAEtB,gBAAG/H,EAAEgI,QAAF,CAAWrC,GAAX,KAAmB,KAAKnD,KAAL,CAAWvB,SAAjC,EAA4C;AAC1C,mBAAK,IAAImE,IAAI,CAAb,EAAgBA,IAAI,KAAK5C,KAAL,CAAWvB,SAAX,CAAqBkD,MAAzC,EAAiDiB,GAAjD,EAAsD;AACpD,oBAAI6C,MAAM,KAAKzF,KAAL,CAAWvB,SAAX,CAAqBmE,CAArB,CAAV;;AAEA;AACA,oBAAIlE,OAAOgH,WAAWD,IAAI/G,IAAf,CAAX;AACA,oBAAIC,KAAK+G,WAAWD,IAAI9G,EAAf,CAAT;AACA,oBAAIA,MAAMwE,GAAN,IAAazE,QAAQyE,GAAzB,EAA8B;AAC5B,yBAAOsC,IAAInH,IAAX;AACD;AACF;AACF;;AAED,gBAAIqH,SAASnI,EAAEoI,KAAF,CAAQzC,GAAR,CAAb;AACA,gBAAG,CAACwC,MAAD,IAAWnI,EAAEqI,QAAF,CAAW1C,GAAX,CAAd,EAA+B;AAC7BA,oBAAMA,IAAI2C,QAAJ,EAAN,CAD6B,CACP;AACvB;;AAED,iBAAK,IAAIlD,IAAI,CAAb,EAAgBA,IAAI,KAAK5C,KAAL,CAAW7B,SAAX,CAAqBwD,MAAzC,EAAiDiB,GAAjD,EAAsD;AACpD,kBAAI6C,MAAM,KAAKzF,KAAL,CAAW7B,SAAX,CAAqByE,CAArB,CAAV;AACA;AACA,kBAAI6C,IAAIrH,KAAJ,KAAc,MAAlB,EAA0B;AACxB,oBAAIuH,MAAJ,EAAY;AACV,yBAAOF,IAAInH,IAAX;AACD;AACD;AACD;;AAED,kBAAG6E,OAAOsC,IAAIrH,KAAd,EAAqB;AACnB,uBAAOqH,IAAInH,IAAX;AACD;AACF;;AAED,gBAAGqH,MAAH,EAAW;AACT,qBAAO,MAAP;AACD;AACD,mBAAOxC,GAAP;AACD;;;mCAEQA,G,EAAK;AACZ,gBAAG3F,EAAEuI,GAAF,CAAM,KAAKC,QAAX,EAAqB7C,GAArB,CAAH,EAA8B;AAC5B,qBAAO,KAAK6C,QAAL,CAAc7C,GAAd,CAAP;AACD;;AAED,gBAAI8C,QAAQ,CACV,SADU,EAEV,SAFU,EAGV,SAHU,EAIV,SAJU,EAKV,SALU,EAMV,SANU,EAOV,SAPU,CAAZ;;AAUA,mBAAOA,MAAO7B,KAAK8B,GAAL,CAAS,KAAKC,QAAL,CAAchD,MAAI,EAAlB,CAAT,IAAkC8C,MAAMtE,MAA/C,CAAP;AACD;;;wCAEa;AACZ,gBAAIyE,UAAU,QAAQC,KAAR,CAAc,EAAd,CAAd;AACA,gBAAIxH,QAAQ,GAAZ;AACA,iBAAK,IAAI+D,IAAE,CAAX,EAAcA,IAAE,CAAhB,EAAmBA,GAAnB,EAAyB;AACrB/D,uBAASuH,QAAQhC,KAAKkC,KAAL,CAAWlC,KAAKmC,MAAL,KAAgBH,QAAQzE,MAAnC,CAAR,CAAT;AACH;AACD,mBAAO9C,KAAP;AACD;;;mCAEQ2H,G,EAAI;AACX,gBAAIC,OAAO,CAAX;AACA,gBAAID,IAAI7E,MAAJ,IAAc,CAAlB,EAAqB,OAAO8E,IAAP;AACrB,iBAAK,IAAI7D,IAAI,CAAb,EAAgBA,IAAI4D,IAAI7E,MAAxB,EAAgCiB,GAAhC,EAAqC;AACnC,kBAAI8D,OAAOF,IAAIG,UAAJ,CAAe/D,CAAf,CAAX;AACA6D,qBAAQ,CAACA,QAAM,CAAP,IAAUA,IAAX,GAAiBC,IAAxB;AACAD,qBAAOA,OAAOA,IAAd,CAHmC,CAGf;AACrB;AACD,mBAAOA,IAAP;AACD;;;uCAIYG,U,EAAY;AACvB,gBAAI,KAAK5G,KAAL,CAAWL,YAAf,EAA6B;AAC3B,kBAAIwC,QAAQ,KAAK0E,OAAL,CAAaC,SAAb,EAAZ;AACA3E,oBAAMzD,IAAN,GAAa,CAAb;AACAyD,oBAAMxD,EAAN,GAAW,KAAKwD,KAAL,CAAWxD,EAAtB;AACA,kBAAIoI,eAAe;AACjBC,yBAAS,KAAKhH,KAAL,CAAWiH,EADH;AAEjB9E,uBAAOA,KAFU;AAGjB+E,0BAAU/E,KAHO;AAIjBgF,0BAAU,QAJO;AAKjBC,4BAAY,WALK;AAMjBC,yBAAS,KAAKrH,KAAL,CAAWqH,OANH;AAOjBC,wBAAQ,KAAKtH,KAAL,CAAWuH,QAAX,KAAwB,KAAxB,GAAgC,KAAhC,GAAwC,MAP/B;AAQjBC,+BAAe,KAAKC,UARH;AASjBC,4BAAY,EATK;AAUjBC,8BAAc,KAAK3H,KAAL,CAAW2H;AAVR,eAAnB;;AAaA,qBAAOf,WAAWgB,KAAX,CAAiBb,YAAjB,CAAP;AACD;AACD,sJAA0BH,UAA1B;AACD;;;uCAEYiB,E,EAAIC,G,EAAKC,G,EAAKC,S,EAAW;AACpCH,eAAG5E,EAAH,GAAS6E,MAAMD,GAAGhF,KAAlB;AACA,gBAAG,CAACkF,IAAIE,aAAR,EAAuB;AACrB,kBAAGzK,EAAEuI,GAAF,CAAMiC,SAAN,EAAiBH,GAAG1E,GAApB,CAAH,EAA6B;AAC3B,oBAAI+E,IAAIF,UAAUH,GAAG1E,GAAb,CAAR;AACA+E,kBAAEjF,EAAF,IAAQ4E,GAAG5E,EAAX;AACAiF,kBAAE7C,KAAF;AACD,eAJD,MAKK;AACH2C,0BAAUH,GAAG1E,GAAb,IAAoB,EAAE,OAAO0E,GAAG1E,GAAZ,EAAiB,MAAM0E,GAAG5E,EAA1B,EAA8B,SAAQ,CAAtC,EAApB;AACD;AACD8E,kBAAIE,aAAJ,GAAqBD,UAAUrG,MAAV,GAAmB,EAAxC;AACD;AACF;;;yCAEcwG,Q,EAAU;AAAA;;AACvBlH,cAAE,KAAKa,MAAP,EAAeX,GAAf,CAAoB,QAApB,EAA8B,SAA9B;;AAEA,gBAAIe,UAAU,KAAKC,KAAL,CAAWxD,EAAX,GAAgB,KAAKwD,KAAL,CAAWzD,IAAzC;AACA,gBAAIX,OAAO,EAAX;AACAP,cAAE4E,OAAF,CAAU+F,QAAV,EAAoB,UAAC9F,MAAD,EAAY;AAC9B,kBAAI2F,YAAY,EAAhB;;AAEA,kBAAI3F,OAAO+F,IAAP,KAAgB,MAApB,EAA4B;AAAE;AAC5B5K,kBAAE4E,OAAF,CAAUC,OAAOgG,UAAjB,EAA6B,UAAC3F,KAAD,EAAW;AACtC,sBAAIG,QAAQpF,OAAO6K,GAAP,CAAW5F,MAAM,OAAK1C,KAAL,CAAWJ,eAAjB,CAAX,CAAZ;AACA,sBAAI2I,UAAU1F,MAAM2F,OAAN,EAAd;AACA,sBAAIV,MAAM,OAAK3F,KAAL,CAAWxD,EAArB;AACA,sBAAI,CAAC,OAAKqB,KAAL,CAAWH,aAAZ,KAA8B6C,MAAM,OAAK1C,KAAL,CAAWH,aAAjB,MAAoC,EAAtE,EAA0E;AACxEiI,0BAAMrK,OAAO6K,GAAP,CAAW5F,MAAM,OAAK1C,KAAL,CAAWH,aAAjB,CAAX,CAAN;AACD;AACD,sBAAI4I,QAAQX,IAAIU,OAAJ,EAAZ;AACA,sBAAI,EAAED,UAAU,OAAKpG,KAAL,CAAWxD,EAArB,IAA2B8J,QAAQ,OAAKtG,KAAL,CAAWzD,IAAhD,CAAJ,EAA2D;AACzD,wBAAImJ,KAAK;AACP1E,2BAAKT,MAAM,OAAK1C,KAAL,CAAWF,cAAjB,CADE;AAEP+C,6BAAO0F,OAFA;AAGPtF,0BAAI6E,IAAIY,IAAJ,CAAS7F,KAAT;AAHG,qBAAT;AAKA,wBAAIkF,MAAM;AACRvJ,4BAAMqJ,GAAG1E,GADD;AAERR,+BAAS,CAACkF,EAAD,CAFD;AAGRI,qCAAe,KAHP;AAIRU,kCAAY,CAAE,EAAE,OAAOd,GAAG1E,GAAZ,EAAiB,MAAM0E,GAAG5E,EAA1B,EAA8B,SAAQ,CAAtC,EAAF;AAJJ,qBAAV;AAMAlF,yBAAK6K,IAAL,CAAUb,GAAV;AACD;AACF,iBAtBD;AAuBD,eAxBD,MAwBO;AACL,oBAAIA,MAAM;AACNvJ,wBAAM6D,OAAOwG,MADP;AAENlG,2BAAS,EAFH;AAGNsF,iCAAe,KAHT;AAINU,8BAAY,EAJN,EAAV;AAKA5K,qBAAK6K,IAAL,CAAWb,GAAX;AACA,oBAAIe,OAAO,IAAX;AACAtL,kBAAE4E,OAAF,CAAUC,OAAOgG,UAAjB,EAA6B,UAAC3F,KAAD,EAAW;;AAEpC,sBAAIqG,OAAO,OAAKC,WAAL,CAAiBtG,MAAM,CAAN,CAAjB,CAAX;AACA,sBAAGoG,QAAM,IAAN,IAAcC,QAAQD,KAAK3F,GAA9B,EAAmC;AAC/B,wBAAI0E,KAAK;AACL1E,2BAAK4F,IADA;AAELlG,6BAAOH,MAAM,CAAN,CAFF;AAGLO,0BAAI,CAHC,CAGC;AAHD,qBAAT;;AAMA,wBAAG6F,QAAM,IAAT,EAAe;AACX,6BAAKG,YAAL,CAAmBH,IAAnB,EAAyBjB,GAAGhF,KAA5B,EAAmCkF,GAAnC,EAAwCC,SAAxC;AACH;;AAEDD,wBAAIpF,OAAJ,CAAYiG,IAAZ,CAAiBf,EAAjB;AACAiB,2BAAOjB,EAAP;AACH;AACJ,iBAjBD;;AAmBA,oBAAGiB,QAAM,IAAT,EAAe;AACX,yBAAKG,YAAL,CAAmBH,IAAnB,EAAyB,OAAK3G,KAAL,CAAWxD,EAApC,EAAwCoJ,GAAxC,EAA6CC,SAA7C;AACH;;AAED;AACA,oBAAIkB,WAAW,OAAKF,WAAL,CAAiB,IAAjB,CAAf;AACA,oBAAIjB,IAAIpF,OAAJ,CAAYhB,MAAZ,GAAqB,CAArB,IAA0BnE,EAAEuI,GAAF,CAAMiC,SAAN,EAAiBkB,QAAjB,CAA9B,EAA4D;AACxD,sBAAI9D,OAAO4C,UAAUkB,QAAV,CAAX;AACA,sBAAG9D,KAAKC,KAAL,IAAc,CAAjB,EAAqB;AACjB,wBAAI8D,MAAO/D,KAAKnC,EAAL,GAAQf,OAAnB;AACA,wBAAIiH,MAAM,GAAV,EAAgB;AACZ,0BAAGpB,IAAIpF,OAAJ,CAAY,CAAZ,EAAeQ,GAAf,IAAsB+F,QAAzB,EAAmC;AAC/BvI,gCAAQC,GAAR,CAAa,eAAb,EAA8BwE,IAA9B;AACA,+BAAO4C,UAAUkB,QAAV,CAAP;;AAEAnB,4BAAIpF,OAAJ,CAAY,CAAZ,EAAeE,KAAf,GAAuBkF,IAAIpF,OAAJ,CAAY,CAAZ,EAAeE,KAAtC;AACAkF,4BAAIpF,OAAJ,CAAY,CAAZ,EAAeM,EAAf,IAAqB8E,IAAIpF,OAAJ,CAAY,CAAZ,EAAeM,EAApC;AACA8E,4BAAIpF,OAAJ,CAAYyG,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB;AACH;AACJ;AACJ;AACJ;AACD5L,kBAAE4E,OAAF,CAAU4F,SAAV,EAAqB,UAAC5J,KAAD,EAAW;AAC5BA,wBAAM+K,GAAN,GAAY/E,KAAKiF,KAAL,CAAajL,MAAM6E,EAAN,GAASf,OAAV,GAAmB,GAA/B,CAAZ;AACA6F,sBAAIY,UAAJ,CAAeC,IAAf,CAAqBxK,KAArB;AACH,iBAHD;AAID;AACF,aAjFD;AAkFA,iBAAKL,IAAL,GAAYA,IAAZ;;AAEA,iBAAKsC,QAAL;;AAEA;AACD;;;yCAEcoF,G,EAAK;AAClB,gBAAI6D,QAAQ9L,EAAE+L,OAAF,CAAU,KAAKvJ,KAAL,CAAWpB,SAArB,EAAgC6G,GAAhC,CAAZ;AACA,iBAAKzF,KAAL,CAAWpB,SAAX,CAAqBwK,MAArB,CAA4BE,KAA5B,EAAmC,CAAnC;AACA,iBAAK7I,eAAL;AACD;;;4CAEiB;AAChB,gBAAI+I,KAAK,EAAT;AACA,iBAAI,IAAI5G,IAAE,CAAV,EAAaA,IAAE,KAAK5C,KAAL,CAAWpB,SAAX,CAAqB+C,MAApC,EAA4CiB,GAA5C,EAAiD;AAC/C,kBAAI6G,IAAI,KAAKzJ,KAAL,CAAWpB,SAAX,CAAqBgE,CAArB,CAAR;AACA,kBAAG6G,EAAEnL,IAAL,EAAW;AACTkL,mBAAGC,EAAEnL,IAAL,IAAamL,EAAE5K,KAAf;AACD;AACF;AACD,iBAAKmH,QAAL,GAAgBwD,EAAhB;AACA,iBAAKE,MAAL;AACD;;;sCAEWC,I,EAAM;AAAA;;AAChB,gBAAGA,QAAQ,QAAX,EAAqB;AACnBnM,gBAAE4E,OAAF,CAAU,KAAKrE,IAAf,EAAqB,UAACsE,MAAD,EAAY;AAC/B,oBAAGA,OAAOsG,UAAV,EAAsB;AACpBnL,oBAAE4E,OAAF,CAAUC,OAAOsG,UAAjB,EAA6B,UAACvD,IAAD,EAAU;AACrC,wBAAG,CAAC5H,EAAEuI,GAAF,CAAMX,KAAKjC,GAAX,CAAJ,EAAqB;AACnB,6BAAKnD,KAAL,CAAWpB,SAAX,CAAqBgK,IAArB,CAA0B,EAACtK,MAAM8G,KAAKjC,GAAZ,EAAiBtE,OAAO,OAAKqE,QAAL,CAAckC,KAAKjC,GAAnB,CAAxB,EAA1B;AACD;AACF,mBAJD;AAKD;AACF,eARD;AASD,aAVD,MAWK;AACH,mBAAKnD,KAAL,CAAWpB,SAAX,CAAqBgK,IAArB,CAA0B,EAACtK,MAAM,KAAP,EAAcO,OAAO,KAAK+K,WAAL,EAArB,EAA1B;AACD;AACD,iBAAKnJ,eAAL;AACD;;;yCAEcgF,G,EAAK;AAClB,gBAAI6D,QAAQ9L,EAAE+L,OAAF,CAAU,KAAKvJ,KAAL,CAAW7B,SAArB,EAAgCsH,GAAhC,CAAZ;AACA,iBAAKzF,KAAL,CAAW7B,SAAX,CAAqBiL,MAArB,CAA4BE,KAA5B,EAAmC,CAAnC;AACA,iBAAKI,MAAL;AACD;;;wCAEa;AACZ,iBAAK1J,KAAL,CAAW7B,SAAX,CAAqByK,IAArB,CAA0B,EAACxK,OAAO,EAAR,EAAYC,IAAI,GAAhB,EAAqBC,MAAM,EAA3B,EAA1B;AACD;;;yCAEcuL,Q,EAAU;AACvB,gBAAIP,QAAQ9L,EAAE+L,OAAF,CAAU,KAAKvJ,KAAL,CAAWvB,SAArB,EAAgCoL,QAAhC,CAAZ;AACA,iBAAK7J,KAAL,CAAWvB,SAAX,CAAqB2K,MAArB,CAA4BE,KAA5B,EAAmC,CAAnC;AACA,iBAAKI,MAAL;AACD;;;wCAEa;AACZ,iBAAK1J,KAAL,CAAWvB,SAAX,CAAqBmK,IAArB,CAA0B,EAAClK,MAAM,EAAP,EAAWC,IAAI,EAAf,EAAmBL,MAAM,EAAzB,EAA1B;AACD;;;4CAEiB;AAChBqC,oBAAQC,GAAR,CAAa,mBAAb;AACA,iBAAK8I,MAAL;AACD;;;2CAMgBI,G,EAAK;AAClB,gBAAItI,OAAO,KAAKM,MAAL,CAAYL,qBAAZ,EAAX;AACA,gBAAIuB,IAAI8G,IAAIC,OAAJ,GAAcvI,KAAKD,IAA3B;AACA,gBAAIW,UAAU,KAAKC,KAAL,CAAWxD,EAAX,GAAgB,KAAKwD,KAAL,CAAWzD,IAAzC;AACA,gBAAImD,QAAQL,KAAKK,KAAjB;AACA,gBAAI,KAAK7B,KAAL,CAAWX,uBAAf,EAAwC;AACpCwC,uBAAS,KAAK7B,KAAL,CAAWV,uBAApB;AACH;AACD,gBAAI0E,KAAK,KAAK7B,KAAL,CAAWzD,IAAX,GAAmBwD,WAASc,IAAEnB,KAAX,CAA5B;;AAEA,mBAAO;AACHmB,iBAAGA,CADA;AAEHgH,iBAAGF,IAAIG,OAAJ,GAAczI,KAAKJ,GAFnB;AAGH4C,kBAAIA,EAHD;AAIH8F,mBAAKA;AAJF,aAAP;AAMH;;;uCAEYA,G,EAAK;AAChB,gBAAG,KAAK/L,IAAR,EAAc;AACZ,kBAAIoE,QAAQ,KAAK0E,OAAL,CAAaC,SAAb,EAAZ;AACA,kBAAIoD,QAAQ,IAAZ;AACA,kBAAIC,IAAI/F,KAAKkC,KAAL,CAAW,KAAK1C,KAAL,CAAWC,QAAX,CAAoBmG,CAApB,GAAsB,KAAKhK,KAAL,CAAW/B,SAA5C,CAAR;AACA,kBAAIkM,IAAI,CAAR,EAAW;AACTA,oBAAI,CAAJ;AACD;AACD,kBAAIA,KAAK,KAAKpM,IAAL,CAAU4D,MAAnB,EAA2B;AACzBwI,oBAAI,KAAKpM,IAAL,CAAU4D,MAAV,GAAiB,CAArB;AACD;AACDuI,sBAAQ,KAAKnM,IAAL,CAAUoM,CAAV,EAAaxH,OAAb,CAAqB,CAArB,CAAR;AACA,mBAAI,IAAIC,IAAE,CAAV,EAAaA,IAAE,KAAK7E,IAAL,CAAUoM,CAAV,EAAaxH,OAAb,CAAqBhB,MAApC,EAA4CiB,GAA5C,EAAiD;AAC/C,oBAAG,KAAK7E,IAAL,CAAUoM,CAAV,EAAaxH,OAAb,CAAqBC,CAArB,EAAwBC,KAAxB,GAAgC,KAAKe,KAAL,CAAWC,QAAX,CAAoBG,EAAvD,EAA2D;AACzD;AACD;AACDkG,wBAAQ,KAAKnM,IAAL,CAAUoM,CAAV,EAAaxH,OAAb,CAAqBC,CAArB,CAAR;AACD;AACD,mBAAKwH,UAAL,GAAkBF,KAAlB;AACA,mBAAKG,WAAL,CAAkBP,GAAlB,EAAuBI,KAAvB;AACD,aAnBD,MAoBK;AACH,mBAAKnF,QAAL,CAAcO,MAAd,GADG,CACqB;AACzB;AACD,iBAAKjF,QAAL,GAxBgB,CAwBC;AAClB;;;yCAEciK,K,EAAO;AACpB,gBAAIzC,KAAK,KAAKuC,UAAd;AACA,gBAAIjI,QAAQ,EAACzD,MAAMjB,OAAO6K,GAAP,CAAWT,GAAGhF,KAAd,CAAP,EAA6BlE,IAAIlB,OAAO6K,GAAP,CAAWT,GAAGhF,KAAH,GAASgF,GAAG5E,EAAvB,CAAjC,EAAZ;AACAtC,oBAAQC,GAAR,CAAa,OAAb,EAAsB2J,EAAtB,EAA0B1C,EAA1B,EAA8B1F,KAA9B;AACA,iBAAK0E,OAAL,CAAa2D,OAAb,CAAqBrI,KAArB;AACAlB,cAAE,KAAKa,MAAP,EAAeX,GAAf,CAAoB,QAApB,EAA8B,MAA9B;AACD;;;+CAEoBgB,K,EAAO;AAC1B,iBAAK0E,OAAL,CAAa2D,OAAb,CAAqBrI,KAArB;AACAlB,cAAE,KAAKa,MAAP,EAAeX,GAAf,CAAoB,QAApB,EAA8B,MAA9B;AACD;;;;QAzoB6B5D,e;;AA4oBhCI,wBAAkB8M,WAAlB,GAAgC,aAAhC;;2BAGE9M,iB","file":"module.js","sourcesContent":["import config from 'app/core/config';\n\nimport {CanvasPanelCtrl} from './canvas-metric';\n\nimport _ from 'lodash';\nimport moment from 'moment';\nimport angular from 'angular';\n\nclass DiscretePanelCtrl extends CanvasPanelCtrl {\n\n  constructor($scope, $injector, $q) {\n    super($scope, $injector, $q);\n\n    this.data = null;\n\n    // Set and populate defaults\n    var panelDefaults = {\n      rowHeight: 50,\n      padding: { 'left': 0, 'right': 0, 'top': 0, 'bottom': 0 },\n      valueMaps: [\n        { value: 'null', op: '=', text: 'N/A' }\n      ],\n      mappingTypes: [\n        {name: 'value to text', value: 1},\n        {name: 'range to text', value: 2},\n      ],\n      rangeMaps: [\n        { from: 'null', to: 'null', text: 'N/A' }\n      ],\n      colorMaps: [\n        { text: 'N/A', color: '#CCC' }\n      ],\n      metricNameColor: '#000000',\n      valueTextColor: '#000000',\n      backgroundColor: 'rgba(128, 128, 128, 0.1)',\n      lineColor: 'rgba(128, 128, 128, 1.0)',\n      writeLastValue: true,\n      writeAllValues: false,\n      writeMetricNames: false,\n      writeMetricNamesOnRight: false,\n      metricNamesOnRightWidth: 400,\n      showLegend: true,\n      showLegendNames: true,\n      showLegendPercent: true,\n      highlightOnMouseover: true,\n      queryAllData: false,\n      eventBeginField: 'begin',\n      eventEndField: 'end',\n      eventNameField: 'desc'\n    };\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n\n    this.updateColorInfo();\n  }\n\n  onDataError(err) {\n    console.log(\"onDataError\", err);\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/natel-discrete-panel/editor.html',1);\n    this.addEditorTab('Colors', 'public/plugins/natel-discrete-panel/colors.html',3);\n    this.addEditorTab('Mappings', 'public/plugins/natel-discrete-panel/mappings.html', 4);\n    this.editorTabIndex = 1;\n    this.refresh();\n  }\n\n  onRender() {\n    if( !(this.context) ) {\n      console.log( 'No context!');\n      return;\n    }\n\n    if(this.data == null) {\n      console.log( 'No data!');\n      return;\n    }\n\n //   console.log( 'render', this.data);\n\n    $(this.wrap).css( 'padding-top', this.panel.padding.top );\n    $(this.wrap).css( 'padding-right', this.panel.padding.right );\n    $(this.wrap).css( 'padding-bottom', this.panel.padding.bottom );\n    $(this.wrap).css( 'padding-left', this.panel.padding.left );\n\n    var rect = this.wrap.getBoundingClientRect();\n\n    var rows = this.data.length;\n    var rowHeight = this.panel.rowHeight;\n\n    var height = rowHeight * rows;\n    var width = rect.width - this.panel.padding.left - this.panel.padding.right;\n    this.canvas.width = width;\n    this.canvas.height = height;\n\n    if (this.panel.writeMetricNamesOnRight) {\n      width -= this.panel.metricNamesOnRightWidth;\n    }\n\n    var ctx = this.context;\n    ctx.lineWidth = 1;\n    ctx.textBaseline = 'middle';\n\n    // ctx.shadowOffsetX = 1;\n    // ctx.shadowOffsetY = 1;\n    // ctx.shadowColor = \"rgba(0,0,0,0.3)\";\n    // ctx.shadowBlur = 3;\n\n    var top = 0;\n\n    var elapsed = this.range.to - this.range.from;\n\n    _.forEach(this.data, (metric) => {\n      var centerV = top + (rowHeight/2);\n\n      // The no-data line\n      ctx.fillStyle = this.panel.backgroundColor;\n      ctx.fillRect(0, top, width, rowHeight);\n\n      /*if(!this.panel.writeMetricNames) {\n        ctx.fillStyle = \"#111111\";\n        ctx.font = '24px \"Open Sans\", Helvetica, Arial, sans-serif';\n        ctx.textAlign = 'left';\n        ctx.fillText(\"No Data\", 10, centerV);\n      }*/\n\n      var lastBS = 0;\n      var point = metric.changes[0];\n      for(var i=0; i<metric.changes.length; i++) {\n        point = metric.changes[i];\n        if(point.start <= this.range.to) {\n            var xt = 0;\n            var w = 0;\n            if (point.start > this.range.from) {\n                xt = point.start - this.range.from;\n                point.x = (xt / elapsed) * width;\n                w = width*(point.ms/elapsed);\n            } else {\n                xt = 0;\n                point.x = 0;\n                w = width*((point.ms-(this.range.from-point.start))/elapsed);\n            }\n          if (point.x + w > width) {\n            w = width-point.x;\n          }\n          ctx.fillStyle = this.getColor( point.val );\n          ctx.fillRect(point.x, top, w, rowHeight);\n\n          if(this.panel.writeAllValues) {\n            ctx.fillStyle = this.panel.valueTextColor;\n            ctx.font = (rowHeight-2) + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\n            ctx.textAlign = 'left';\n\n            ctx.fillText(point.val, point.x+7, centerV);\n          }\n          lastBS = point.x;\n        }\n      }\n\n\n\n      if(top>0) {\n        ctx.strokeStyle = this.panel.lineColor;\n        ctx.beginPath();\n        ctx.moveTo(0, top);\n        ctx.lineTo(width, top);\n        ctx.stroke();\n      }\n\n      ctx.fillStyle = \"#000000\";\n      ctx.font = (rowHeight-2) + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\n\n      if(this.panel.writeMetricNames && (!this.panel.highlightOnMouseover || (this.panel.highlightOnMouseover && (this.mouse.position==null || this.mouse.position.x > 200 ) ) ) ) {\n        ctx.fillStyle = this.panel.metricNameColor;\n        ctx.textAlign = 'left';\n        var x = 10;\n        if (this.panel.writeMetricNamesOnRight) {\n          x = width+10;\n        }\n        ctx.fillText( metric.name, x, centerV);\n      }\n\n      ctx.textAlign = 'right';\n\n      if( this.mouse.down == null ) {\n        if( this.panel.highlightOnMouseover && this.mouse.position != null ) {\n          point = metric.changes[0];\n          var next = null;\n          for(var i=0; i<metric.changes.length; i++) {\n            if(metric.changes[i].start > this.mouse.position.ts) {\n              next = metric.changes[i];\n              break;\n            }\n            point = metric.changes[i];\n          }\n\n          // Fill canvas using 'destination-out' and alpha at 0.05\n          ctx.globalCompositeOperation = 'destination-out';\n          ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\n          ctx.beginPath();\n          ctx.fillRect(0, top, point.x, rowHeight);\n          ctx.fill();\n\n          if(next != null) {\n            ctx.beginPath();\n            ctx.fillRect(next.x, top, width, rowHeight);\n            ctx.fill();\n          }\n          ctx.globalCompositeOperation = 'source-over';\n\n          // Now Draw the value\n          ctx.fillStyle = \"#000000\";\n          ctx.font = (rowHeight-2) + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\n          ctx.textAlign = 'left';\n          ctx.fillText( point.val, point.x+10, centerV);\n\n\n          // ctx.fillText( point.val, this.mouse.position.x-10, centerV);\n\n          // if(point.ms > 2) {\n          //   ctx.textAlign = 'left';\n          //   ctx.font = '18px \"Open Sans\", Helvetica, Arial, sans-serif';\n\n          //   var msg = moment.duration( point.ms ).humanize(false);\n          //   ctx.fillText(msg, this.mouse.position.x+10, centerV);\n          // }\n        }\n        else if( this.panel.writeLastValue ) {\n          ctx.fillText( point.val, width-10, centerV );\n        }\n      }\n\n      top += rowHeight;\n    });\n\n\n    if(this.mouse.position != null && this.mouse.position.x < width) {\n      if(this.mouse.down != null) {\n        var xmin = Math.min( this.mouse.position.x, this.mouse.down.x);\n        var xmax = Math.max( this.mouse.position.x, this.mouse.down.x);\n\n        // Fill canvas using 'destination-out' and alpha at 0.05\n        ctx.globalCompositeOperation = 'destination-out';\n        ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\n        ctx.beginPath();\n        ctx.fillRect(0, 0, xmin, height);\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.fillRect(xmax, 0, width, height);\n        ctx.fill();\n        ctx.globalCompositeOperation = 'source-over';\n      }\n      else {\n        ctx.strokeStyle = '#111';\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.lineWidth = 3;\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.strokeStyle = '#e22c14';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n      }\n    }\n  }\n\n  showTooltip(pos, point) {\n    var from = point.start;\n    var to = point.start + point.ms;\n    var time = point.ms;\n    var val = point.val;\n\n    if(this.mouse.down != null) {\n      from = Math.min(this.mouse.down.ts, this.mouse.position.ts);\n      to   = Math.max(this.mouse.down.ts, this.mouse.position.ts);\n      time = to - from;\n      val = \"Zoom To:\";\n    }\n\n    var body = '<div class=\"graph-tooltip-time\">'+ val + '</div>';\n    \n    body += \"<center>\"\n    body += this.dashboard.formatDate( moment(from) ) + \"<br/>\";\n    body += \"to<br/>\";\n    body += this.dashboard.formatDate( moment(to) ) + \"<br/><br/>\";\n    body += moment.duration(time).humanize() + \"<br/>\";\n    body += \"</center>\"\n\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  };\n\n\n  showLegandTooltip(pos, info) {\n    var body = '<div class=\"graph-tooltip-time\">'+ info.val +'</div>';\n    \n    body += \"<center>\";\n    if(info.count > 1) {\n      body += info.count + \" times<br/>for<br/>\";\n    }\n    body += moment.duration(info.ms).humanize();\n    if(info.count > 1) {\n      body += \"<br/>total\";\n    }\n    body += \"</center>\"\n\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  }\n\n  clearTT() {\n    this.$tooltip.detach(); \n  }\n\n  formatValue(val, stats) {\n\n    if(_.isNumber(val) && this.panel.rangeMaps) {\n      for (var i = 0; i < this.panel.rangeMaps.length; i++) {\n        var map = this.panel.rangeMaps[i];\n\n        // value/number to range mapping\n        var from = parseFloat(map.from);\n        var to = parseFloat(map.to);\n        if (to >= val && from <= val) {\n          return map.text;\n        }\n      }\n    }\n\n    var isNull = _.isNil(val);\n    if(!isNull && _.isString(val)) {\n      val = val.toString(); // convert everything to a string\n    }\n\n    for (var i = 0; i < this.panel.valueMaps.length; i++) {\n      var map = this.panel.valueMaps[i];\n      // special null case\n      if (map.value === 'null') {\n        if (isNull) {\n          return map.text;\n        }\n        continue;\n      }\n\n      if(val == map.value) {\n        return map.text;\n      }\n    }\n\n    if(isNull) {\n      return \"null\";\n    }\n    return val;\n  }\n\n  getColor(val) {\n    if(_.has(this.colorMap, val)) {\n      return this.colorMap[val];\n    }\n\n    var palet = [\n      '#FF4444',\n      '#9933CC',\n      '#32D1DF',\n      '#ed2e18',\n      '#CC3900',\n      '#F79520',\n      '#33B5E5'\n    ];\n\n    return palet[ Math.abs(this.hashCode(val+'')) % palet.length ];\n  }\n\n  randomColor() {\n    var letters = 'ABCDE'.split('');\n    var color = '#';\n    for (var i=0; i<3; i++ ) {\n        color += letters[Math.floor(Math.random() * letters.length)];\n    }\n    return color;\n  }\n\n  hashCode(str){\n    var hash = 0;\n    if (str.length == 0) return hash;\n    for (var i = 0; i < str.length; i++) {\n      var char = str.charCodeAt(i);\n      hash = ((hash<<5)-hash)+char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  }\n\n  //-----------\n\n  issueQueries(datasource) {\n    if (this.panel.queryAllData) {\n      var range = this.timeSrv.timeRange();\n      range.from = 0;\n      range.to = this.range.to;\n      var metricsQuery = {\n        panelId: this.panel.id,\n        range: range,\n        rangeRaw: range,\n        interval: 31557600,\n        intervalMs: 31557600000,\n        targets: this.panel.targets,\n        format: this.panel.renderer === 'png' ? 'png' : 'json',\n        maxDataPoints: this.resolution,\n        scopedVars: {},\n        cacheTimeout: this.panel.cacheTimeout\n      };\n\n      return datasource.query(metricsQuery);\n    }\n    return super.issueQueries(datasource);\n  }\n\n  _processLast(pt, end, res, valToInfo) {\n    pt.ms = (end - pt.start);\n    if(!res.tooManyValues) {\n      if(_.has(valToInfo, pt.val)) {\n        var v = valToInfo[pt.val];\n        v.ms += pt.ms;\n        v.count++;\n      }\n      else {\n        valToInfo[pt.val] = { 'val': pt.val, 'ms': pt.ms, 'count':1 };\n      }\n      res.tooManyValues = (valToInfo.length > 20);\n    }\n  }\n\n  onDataReceived(dataList) {\n    $(this.canvas).css( 'cursor', 'pointer' );\n\n    var elapsed = this.range.to - this.range.from;\n    var data = [];\n    _.forEach(dataList, (metric) => {\n      var valToInfo = {};\n\n      if (metric.type === 'docs') { // handle discrete events\n        _.forEach(metric.datapoints, (point) => {\n          var start = moment.utc(point[this.panel.eventBeginField]);\n          var startMs = start.valueOf();\n          var end = this.range.to;\n          if ([this.panel.eventEndField] && point[this.panel.eventEndField] !== '') {\n            end = moment.utc(point[this.panel.eventEndField]);\n          }\n          var endMs = end.valueOf();\n          if (!(startMs > this.range.to || endMs < this.range.from)) {\n            var pt = {\n              val: point[this.panel.eventNameField],\n              start: startMs,\n              ms: end.diff(start)\n            };\n            var res = {\n              name: pt.val,\n              changes: [pt],\n              tooManyValues: false,\n              legendInfo: [ { 'val': pt.val, 'ms': pt.ms, 'count':1 } ]\n            };\n            data.push(res);\n          }\n        });\n      } else {\n        var res = { \n            name: metric.target, \n            changes: [],\n            tooManyValues: false,\n            legendInfo: [] };\n        data.push( res );\n        var last = null;\n        _.forEach(metric.datapoints, (point) => {\n\n            var norm = this.formatValue(point[0]);\n            if(last==null || norm != last.val) {\n                var pt = {\n                    val: norm,\n                    start: point[1],\n                    ms: 0 // time in this state\n                }\n\n                if(last!=null) {\n                    this._processLast( last, pt.start, res, valToInfo);\n                };\n\n                res.changes.push(pt);\n                last = pt;\n            }\n        });\n\n        if(last!=null) {\n            this._processLast( last, this.range.to, res, valToInfo);\n        };\n\n        // Remove null from the legend if it is the first value and small (common for influx queries)\n        var nullText = this.formatValue(null);\n        if( res.changes.length > 1 && _.has(valToInfo, nullText ) ) {\n            var info = valToInfo[nullText];\n            if(info.count == 1 ) { \n                var per = (info.ms/elapsed);\n                if( per < .02 ) {\n                    if(res.changes[0].val == nullText) {\n                        console.log( 'Removing null', info );\n                        delete valToInfo[nullText];\n\n                        res.changes[1].start = res.changes[0].start;\n                        res.changes[1].ms += res.changes[0].ms;\n                        res.changes.splice(0, 1);\n                    }\n                }\n            }\n        }\n        _.forEach(valToInfo, (value) => {\n            value.per = Math.round( (value.ms/elapsed)*100 );\n            res.legendInfo.push( value );\n        });\n      }\n    });\n    this.data = data;\n    \n    this.onRender();\n\n    //console.log( 'data', dataList, this.data);\n  }\n\n  removeColorMap(map) {\n    var index = _.indexOf(this.panel.colorMaps, map);\n    this.panel.colorMaps.splice(index, 1);\n    this.updateColorInfo();\n  };\n\n  updateColorInfo() {\n    var cm = {};\n    for(var i=0; i<this.panel.colorMaps.length; i++) {\n      var m = this.panel.colorMaps[i];\n      if(m.text) {\n        cm[m.text] = m.color;\n      }\n    }\n    this.colorMap = cm;\n    this.render();\n  }\n\n  addColorMap(what) {\n    if(what == 'curent') {\n      _.forEach(this.data, (metric) => {\n        if(metric.legendInfo) {\n          _.forEach(metric.legendInfo, (info) => {\n            if(!_.has(info.val)) {\n              this.panel.colorMaps.push({text: info.val, color: this.getColor(info.val) });\n            }\n          });\n        }\n      });\n    }\n    else {\n      this.panel.colorMaps.push({text: '???', color: this.randomColor() });\n    }\n    this.updateColorInfo();\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  };\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  };\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\n  }\n\n  onConfigChanged() {\n    console.log( \"Config changed...\");\n    this.render();\n  }\n\n  //------------------\n  // Mouse Events\n  //------------------\n\n  getMousePosition(evt) {\n      var rect = this.canvas.getBoundingClientRect();\n      var x = evt.clientX - rect.left;\n      var elapsed = this.range.to - this.range.from;\n      var width = rect.width;\n      if (this.panel.writeMetricNamesOnRight) {\n          width -= this.panel.metricNamesOnRightWidth;\n      }\n      var ts = this.range.from + (elapsed*(x/width));\n\n      return {\n          x: x,\n          y: evt.clientY - rect.top,\n          ts: ts,\n          evt: evt\n      };\n  }\n\n  onMouseMoved(evt) {\n    if(this.data) {\n      var range = this.timeSrv.timeRange();\n      var hover = null;\n      var j = Math.floor(this.mouse.position.y/this.panel.rowHeight);\n      if (j < 0) {\n        j = 0;\n      }\n      if (j >= this.data.length) {\n        j = this.data.length-1;\n      }\n      hover = this.data[j].changes[0];\n      for(var i=0; i<this.data[j].changes.length; i++) {\n        if(this.data[j].changes[i].start > this.mouse.position.ts) {\n          break;\n        }\n        hover = this.data[j].changes[i];\n      }\n      this.hoverPoint = hover;\n      this.showTooltip( evt, hover );\n    }\n    else {\n      this.$tooltip.detach(); // make sure it is hidden\n    }\n    this.onRender(); // refresh the view\n  }\n\n  onMouseClicked(where) {\n    var pt = this.hoverPoint;\n    var range = {from: moment.utc(pt.start), to: moment.utc(pt.start+pt.ms) };\n    console.log( \"CLICK\", up, pt, range );\n    this.timeSrv.setTime(range);\n    $(this.canvas).css( 'cursor', 'wait' );\n  }\n\n  onMouseSelectedRange(range) {\n    this.timeSrv.setTime(range);\n    $(this.canvas).css( 'cursor', 'wait' ); \n  }\n\n}\nDiscretePanelCtrl.templateUrl = 'module.html';\n\nexport {\n  DiscretePanelCtrl as PanelCtrl\n};\n\n\n"]}